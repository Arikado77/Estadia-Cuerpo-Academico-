<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Noticias.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="CA.css">
    <title>Noticias</title>
</head>
<body>

    <nav>
        <div class="brand">
            <img src="img/Gemini_Generated_Image_6fk5kt6fk5kt6fk5.png" alt="">
            <a href="#" class="logo">Cuerpo Acad√©mico</a>
        </div>
        <div class="links">
            <a href="#" onclick="window.location.href='index.html'">Inicio</a>
            <a href="#que-es" onclick="window.location.href='CA.html'">¬øQu√© es CA?</a>
            <a href="#lineas" onclick="window.location.href='Conocimiento.html'">L√≠neas de Conocimiento</a>
            <a href="#noticias" onclick="window.location.href='Noticias.html'">Noticias y mas</a>
            <a href="#Sitios" onclick="window.location.href='Sitios.html'">Proyectos</a>
        </div>
        <div class="nav-bar">
            <div id="auth-link">
                <a href="login.html" class="login-button">Iniciar Sesi√≥n</a>
            </div>
        </div>
    </nav>

    <div id="admin-panel" style="display:none;">
        <hr>
        <h2>Panel de Administraci√≥n</h2>
        <div class="admin-controls">
            <button class="admin-button add-button">Agregar Noticia</button>
            <button class="admin-button add-button">Agregar Congreso</button>
            <button class="admin-button add-button">Agregar Foro</button>
            <button class="admin-button add-button">Agregar Charla</button>
        </div>
        <hr>
    </div>

    <main class="noticias-main">
        <div class="noticias-container">
            
            <section class="social-qr-section">
                <h2>S√≠guenos en Redes Sociales</h2>
                <br>
                <p>Escanea los c√≥digos QR o da click en la palabra para acceder a nuestras √∫ltimas novedades.</p>
                <div class="qr-grid">
                    
                    <div class="qr-item">
                        <img src="img/Facebook-QR.jpg" alt="C√≥digo QR de Facebook" class="qr-code">
                        <a href="https://www.facebook.com/share/17CRf41CNG/?mibextid=wwXIfr" target="_blank" class="qr-link">Facebook</a>
                    </div>
                    
                    <div class="qr-item">
                        <img src="img/Instagram-QR.jpg" alt="C√≥digo QR de Instagram" class="qr-code">
                        <a href="https://www.instagram.com/ca_utch?igsh=MXAyMmVmYnRpMzAxbg%3D%3D&utm_source=qr" target="_blank" class="qr-link">Instagram</a>
                    </div>
                </div>
            </section>
            
            <div id="admin-panel" style="display:none;">
                <hr>
                <h2>Panel de Administraci√≥n</h2>
                <div class="admin-controls">
                    <button class="admin-button add-button">‚ûï Agregar Noticia</button>
                    <button class="admin-button add-button">‚ûï Agregar Congreso</button>
                    </div>
                <hr>
            </div>

            <section class="noticias-section">
                <h2>Noticias Recientes desde la Web</h2>
                
                <div class="noticia-item">
                    <div class="edit-buttons" style="display:none;">
                        <button class="edit-button">‚úèÔ∏è</button>
                        <button class="delete-button">üóëÔ∏è</button>
                    </div>
                    <h3>T√≠tulo de la Noticia 1</h3>
                    <p>Descripci√≥n corta de la noticia. Aqu√≠ puedes poner un resumen del evento o art√≠culo m√°s reciente.</p>
                    <a href="#" class="read-more">Leer m√°s</a>
                </div>

                <div class="noticia-item">
                    <div class="edit-buttons" style="display:none;">
                        <button class="edit-button">‚úèÔ∏è</button>
                        <button class="delete-button">üóëÔ∏è</button>
                    </div>
                    <h3>Publicaci√≥n de Investigaci√≥n: 'Avances en Ciberseguridad Cu√°ntica'</h3>
                    <p>El Cuerpo Acad√©mico ha publicado un nuevo art√≠culo en la revista internacional "Journal of Tech Security" detallando sus hallazgos sobre criptograf√≠a post-cu√°ntica.</p>
                    <a href="#" class="read-more">Ver Publicaci√≥n</a>
                </div>

                <div class="noticia-item">
                    <div class="edit-buttons" style="display:none;">
                        <button class="edit-button">‚úèÔ∏è</button>
                        <button class="delete-button">üóëÔ∏è</button>
                    </div>
                    <h3>Invitaci√≥n: Participaci√≥n en el Congreso Nacional de TI (CNTI 2025)</h3>
                    <p>Nuestros miembros presentar√°n 3 ponencias sobre an√°lisis forense y protecci√≥n de datos en la pr√≥xima edici√≥n del congreso CNTI que se celebrar√° en la Ciudad de M√©xico en noviembre.</p>
                    <a href="#" class="read-more">Ver Agenda</a>
                </div>
                
            </section>

            </div>
    </main>

    <script src="Script.js"></script>
    <script src="Noticias.js"></script>

    <script>

        document.addEventListener('DOMContentLoaded', () => {
            const authLinkContainer = document.getElementById('auth-link');
            const adminPanel = document.getElementById('admin-panel'); // Para mostrar el panel

            // Funci√≥n para crear el men√∫ de perfil (adaptada para Noticias.html)
            const createProfileDropdown = (userEmail) => {
                // ... (Tu c√≥digo de creaci√≥n de profileDropdown, profileButton, dropdownContent, viewProfileLink, y logoutButton va aqu√≠) ...
                // Utiliza la l√≥gica que ya tienes en index.html, asegur√°ndote de que el logout use fetch('/api/logout')

                // EJEMPLO SIMPLIFICADO de c√≥mo debe verse el resultado
                authLinkContainer.innerHTML = `
                    <div class="profile-dropdown">
                        <button class="profile-button">Hola, ${userEmail.split('@')[0]} ‚ñº</button>
                        <div class="dropdown-content">
                            <a href="perfil.html">Ver Perfil</a>
                            <a href="#" id="logout-link" class="logout-link-style">Cerrar Sesi√≥n</a>
                        </div>
                    </div>
                `;
                
                // Adjuntar el evento de CERRAR SESI√ìN (IMPORTANTE)
                document.getElementById('logout-link').addEventListener('click', async (e) => {
                    e.preventDefault();
                    await fetch('/api/logout', { method: 'POST' });
                    window.location.reload();
                });
                
                // Adjuntar el evento para mostrar/ocultar el dropdown
                document.querySelector('.profile-button').addEventListener('click', () => {
                    document.querySelector('.dropdown-content').classList.toggle('show-dropdown');
                });

            }; // Fin de createProfileDropdown

            // 1. Verificar el estado de la sesi√≥n
            fetch('/api/status')
                .then(res => {
                    if (!res.ok) {
                        // Si la red falla o el servidor devuelve un error, asumimos no autenticado.
                        throw new Error('No se pudo conectar para verificar la sesi√≥n.');
                    }
                    return res.json();
                })
                .then(data => {
                    if (data.isAuthenticated) {
                        // A. SESI√ìN ACTIVA: Cargar la interfaz
                        createProfileDropdown(data.userEmail); // Asume que el servidor devuelve userEmail
                        adminPanel.style.display = 'block'; // Mostrar el panel
                    } else {
                        // B. SESI√ìN INACTIVA: REDIRIGIR A LOGIN (PROTECCI√ìN)
                        alert('Debes iniciar sesi√≥n para ver esta secci√≥n.');
                        window.location.href = '/login.html';
                    }
                })
                .catch(error => {
                    console.error('Fallo al verificar la sesi√≥n:', error);
                    // Si hay un fallo de red o servidor, redirigir por seguridad
                    window.location.href = '/login.html'; 
                });
        });
        
    </script>
    
</body>
</html>